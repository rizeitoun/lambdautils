AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Description: Template of AutoBranching Lambda Function
Parameters:
  LambdaFunctionParameter:
    Type: String
    Default: git_branching.lambda_handler
    AllowedValues:
      - git_branching.lambda_handler
      - git_statuses.lambda_handler
    Description: Lambda Function to run.
  StageName:
    Type: String
    Description: The name of the stage, e.g. "dev", "preprod", "prod"
    Default: dev
Resources:
  ApiGatewayApi:
    Type: AWS::Serverless::Api
    Properties:
      Name:
        Fn::Sub: todo-app-api-${StageName}
      Description: API monitoring git creating/deleting branches.
      StageName:
        Ref: StageName
      EndpointConfiguration: REGIONAL
  BranchFunction:
    Type: AWS::Serverless::Function
    Properties:
      Handler:
        Ref: LambdaFunctionParameter
      Runtime: python3.7
      CodeUri: ./
      Role: >-
        arn:aws:iam::359042822489:role/service-role/gitBranchChange-role-feip54yw
      Events:
        ApiEvent:
          Type: Api
          Properties:
            Path: /v1/git
            RestApiId:
              Ref: ApiGatewayApi
            Method: ANY
      Environment:
        Variables:
          oauth: >-
            AQICAHiGwA1MaRcBVUzLJnkgfCGNqmYiGUA1FHzkR0Dpvb5WUAFXdYE3/lyST/zqUweqmrR1AAAAhzCBhAYJKoZIhvcNAQcGoHcwdQIBADBwBgkqhkiG9w0BBwEwHgYJYIZIAWUDBAEuMBEEDF/DngKpPgtu/+rapAIBEIBDkY7BbWUQKlGKoMuUS5WJBs5qd5oyC64UWTX+93QmXNkc/fzlI8j7FG6yXiKT+gc38gaZthQlgg0N+SDK34TBKQiV0g==
          secret: >-
            AQICAHiGwA1MaRcBVUzLJnkgfCGNqmYiGUA1FHzkR0Dpvb5WUAEMW8AZPb5jxrD4nhxrMsVrAAAAZDBiBgkqhkiG9w0BBwagVTBTAgEAME4GCSqGSIb3DQEHATAeBglghkgBZQMEAS4wEQQMPtD6uQuhJp21cJbLAgEQgCExQL4D6eZmbBWFUXbEfcCx6rDg5JpM5bMF/v1vleXew8Y=
